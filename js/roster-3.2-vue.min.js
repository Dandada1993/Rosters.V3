function showStartupModal(){$("#selectLocations-dialog").modal({backdrop:"static",keyboard:!1})}function hideModal(){$("#selectLocations-dialog").modal("hide")}function showSelectEmployeeModal(){$("#selectemployee-dialog").modal("show")}function hideSelectEmployeeModal(){$("#selectemployee-dialog").modal("hide")}function showShiftEntryModal(){$("#shiftentry-dialog").modal("show")}function hideShiftEntryModal(){$("#shiftentry-dialog").modal("hide")}function Shift(t,e=""){if(!new.target)return new Shift(t,e);this.date=t,this.shift=e,this.starttime=null,this.endtime=null,this.location="",this.position="",this.qualifier="",this.comment="",this.isOnLoan=!1,this.parse=function(){if(Validator.validShift(this.shift)){let t=Validator.getTime(this.shift);this.starttime=new moment(`${this.date.format("YYYY-MM-DD")} ${t.start}`,"YYYY-MM-DD hh:mm a"),this.endtime=new moment(`${this.date.format("YYYY-MM-DD")} ${t.end}`,"YYYY-MM-DD hh:mm a"),this.endtime.diff(this.starttime)<0&&this.endtime.add(1,"days"),this.location=Validator.getLocation(this.shift);let e=Validator.getPosition(this.shift);this.qualifier=e.qualifier,this.position=e.position,this.comment=Validator.getComment(this.shift)}},this.hours=function(t=!0){if(this.starttime&&this.endtime){let e=this.endtime.diff(this.starttime,"minutes");return e>parseInt(data.location.minimumforbreak)&&t&&(e-=data.getBreakLength(this.location)),e/60}return 0},this.format=function(t,e={}){if(this.starttime&&this.endtime){let i=`${this.starttime.format("h:mm a")} - ${this.endtime.format("h:mm a")}`;return"short"===t?i=i.replace(/(:00)/g,"").replace(/\s/g,""):"extrashort"==t&&(i=i.replace(/(:00)/g,"").replace(/\s/g,"").replace(/M/gi,"")),this.location&&e.showlocation&&(i+=` @${this.location}`),this.qualifier&&e.showqualifier&&(i+=` #${this.qualifier}`),this.position&&(e.showposition||e.showqualifier)&&(i+=` ${this.position}`),this.comment&&(i+=` **${this.comment}`),i.toUpperCase()}return""}}function Schedule(t){if(!new.target)return new Schedule(t);this.date=t,this.shiftstring="",this.defaultLocation="",this.defaultQualifier="",this.defaultPosition="",this.firstShift=null,this.secondShift=null,this.setShifts=function(){if(Validator.isTimes(this.shiftstring)){let t=this.shiftstring.split("/");this.firstShift=new Shift(this.date,t[0]),this.firstShift.parse(),2===t.length&&t[1].trim()?(this.secondShift=new Shift(this.date,t[1]),this.secondShift.parse(),this.secondShift.location?this.firstShift.location||(this.firstShift.location=this.secondShift.location):(this.secondShift.location=this.defaultLocation,this.firstShift.location||(this.firstShift.location=this.secondShift.location)),this.secondShift.qualifier?this.firstShift.qualifier||(this.firstShift.qualifier=this.secondShift.qualifier):(this.secondShift.qualifier=this.defaultQualifier,this.firstShift.qualifier||(this.firstShift.qualifier=this.secondShift.qualifier)),this.secondShift.position?this.firstShift.position||(this.firstShift.position=this.secondShift.position):(this.secondShift.position=this.defaultPosition,this.firstShift.position||(this.firstShift.position=this.secondShift.position))):(this.firstShift.location||(this.firstShift.location=this.defaultLocation),this.firstShift.qualifier||(this.firstShift.qualifier=this.defaultQualifier),this.firstShift.position||(this.firstShift.position=this.defaultPosition)),this.secondShift&&this.secondShift.location!==data.location.locID&&(this.secondShift.isOnLoan=!0),this.firstShift&&this.firstShift.location!==data.location.locID&&(this.firstShift.isOnLoan=!0)}else this.firstShift=null,this.secondShift=null},this.isExcuse=function(){return Validator.isExcuse(this.shiftstring)},this.isTime=function(){return Validator.isTimes(this.shiftstring)},this.isSplit=function(){return!!this.secondShift},this.formatFirstShift=function(t,e=null){e||(e=this.defaultQualifier);let i={};return this.secondShift?(this.secondShift.location===this.firstShift.location?i.showlocation=!1:this.firstShift.location!==this.defaultLocation&&(i.showlocation=!0),this.secondShift.qualifier===this.firstShift.qualifier?i.showqualifier=!1:this.firstShift.qualifier!==e&&(i.showqualifier=!0),this.secondShift.position===this.firstShift.position?i.showposition=!1:this.firstShift.position!==this.defaultPosition&&(i.showposition=!0)):(this.firstShift.location!==this.defaultLocation&&(i.showlocation=!0),this.firstShift.qualifier!==e&&(i.showqualifier=!0),this.firstShift.position!==this.defaultPosition&&(i.showposition=!0)),this.firstShift.format(t,i)},this.formatSecondShift=function(t,e=null){e||(e=this.defaultQualifier);let i={};return this.secondShift.location===this.firstShift.location?this.secondShift.location===this.defaultLocation?i.showlocation=!1:i.showlocation=!0:this.secondShift.location!==this.defaultLocation&&(i.showlocation=!0),this.secondShift.qualifier===this.firstShift.qualifier?this.secondShift.qualifier===e?i.showqualifier=!1:i.showqualifier=!0:this.secondShift.qualifier!==e&&(i.showqualifier=!0),this.secondShift.position===this.firstShift.position?this.secondShift.position===this.defaultPosition?i.showposition=!1:i.showposition=!0:this.secondShift.position!==this.defaultPosition&&(i.showposition=!0),this.secondShift.format(t,i)},this.format=function(t,e=!0){let i="";if(Validator.isExcuse(this.shiftstring))i=this.shiftstring;else if(Validator.isTimes(this.shiftstring)||this.firstShift){this.firstShift||this.setShifts();let e={};if(this.secondShift){let s={};this.secondShift.location===this.firstShift.location?(e.showlocation=!1,this.secondShift.location===this.defaultLocation?s.showlocation=!1:s.showlocation=!0):(this.firstShift.location!==this.defaultLocation&&(e.showlocation=!0),this.secondShift.location!==this.defaultLocation&&(s.showlocation=!0)),this.secondShift.qualifier===this.firstShift.qualifier?(e.showqualifier=!1,this.secondShift.qualifier===this.defaultQualifier?s.showqualifier=!1:s.showqualifier=!0):(this.firstShift.qualifier!==this.defaultQualifier&&(e.showqualifier=!0),this.secondShift.qualifier!==this.defaultQualifier&&(s.showqualifier=!0)),this.secondShift.position===this.firstShift.position?(e.showposition=!1,this.secondShift.position===this.defaultPosition?s.showposition=!1:s.showposition=!0):(this.firstShift.position!==this.defaultPosition&&(e.showposition=!0),this.secondShift.position!==this.defaultPosition&&(s.showposition=!0)),i=`${this.firstShift.format(t,e)}/${this.secondShift.format(t,s)}`}else this.firstShift.location!==this.defaultLocation&&(e.showlocation=!0),this.firstShift.qualifier!==this.defaultQualifier&&(e.showqualifier=!0),this.firstShift.position!==this.defaultPosition&&(e.showposition=!0),i=this.firstShift.format(t,e)}return e&&(this.shiftstring=i.toUpperCase()),i.toUpperCase()},this.getFullShiftString=function(){let t={showlocation:!0,showqualifier:!0,showposition:!0};return this.setShifts(),this.isExcuse()?this.shiftstring:this.secondShift?`${this.firstShift.format("short",t)}/${this.secondShift.format("short",t)}`:this.firstShift.format("short",t)},this.hours=function(){var t=0;return Validator.isTimes(this.shiftstring)&&this.firstShift&&(t=this.secondShift?this.firstShift.hours(!1)+this.secondShift.hours(!1):this.firstShift.hours()),t},this.isValid=function(){return this.isEmpty()||Validator.validShifts(this.shiftstring)},this.isEmpty=function(){return!this.shiftstring},this.changeLocation=function(t){this.isEmpty()||this.isExcuse()||(this.firstShift&&(this.firstShift.location=t),this.secondShift&&(this.secondShift.location=t),this.format("short"))},this.changePosition=function(t){if(!this.isEmpty()&&!this.isExcuse()){let e=Validator.getPosition(t);this.firstShift&&(this.firstShift.position=e.position,this.firstShift.qualifier=e.qualifier),this.secondShift&&(this.secondShift.position=e.position,this.secondShift.qualifier=e.qualifier),this.format("short")}}}let autoSave=null,data={employees:[],location:null,roster:null,locations:[],clipboard:"",shortcuts:[],openinghours:[],getOpeningHours:function(t,e){let i=parseInt(e.format("e"))+1;if(this.openinghours)for(let e of this.openinghours)if(e.locID===t&&e.weekday==i){let t=!1,i=null,s=null;return"1"===e.is_open&&(t=!0,i=new moment(e.opening,"YYYY-MM-DD HH:mm"),s=new moment(e.closing,"YYYY-MM-DD HH:mm")),{is_open:t,opening:i,closing:s}}return null},getBreakLength:function(t){for(let e of this.locations)if(e.locID===t)return parseInt(e.breaklength);return 0},getMinimumShift:function(t){for(let e of this.locations)if(e.locID===t)return parseInt(e.minimumshift);return 0},getMaximumShift:function(t){for(let e of this.locations)if(e.locID===t)return parseInt(e.maximumshift);return 0},getStartShiftBuffer:function(t){for(let e of this.locations)if(e.locID===t)return parseInt(e.start_shiftbuffer);return 0},getEndShiftBuffer:function(t){for(let e of this.locations)if(e.locID===t)return parseInt(e.end_shiftbuffer);return 0},isOpen:function(t,e){let i=parseInt(e.format("e"))+1;if(this.openinghours)for(let e of this.openinghours)if(e.locID===t&&e.weekday==i)return"1"===e.is_open;return null}};const EventBus=new Vue;(function(t,e){t.fn.contextMenu=function(i){function s(s,o,n){var l=t(e)[o](),h=t(e)[n](),r=t(i.menuSelector)[o](),a=s+h;return s+r>l&&r<s&&(a-=r),a}return this.each(function(){t(this).on("contextmenu",function(e){var o=t(i.menuSelector).data("invokedOn",t(e.target)).show().css({position:"absolute",left:s(e.clientX,"width","scrollLeft"),top:s(e.clientY,"height","scrollTop")}).off("click").on("click","a",function(e){o.hide();var s=o.data("invokedOn"),n=t(e.target);i.menuSelected.call(this,s,n)});return!1}),t("body").click(function(){t(i.menuSelector).hide()})})}})(jQuery,window),$(function(){$('[data-toggle="tooltip"]').tooltip()});let patterns={excusecode:"^(off(?:\\(r\\))?|~)$",times:"(^(?:0?\\d|1(?:0|1|2))(?:(\\:)?(?:0|3)0)?\\s*(?:a|p)m?)\\s*-\\s*((?:0?\\d|1(?:0|1|2))(?:(\\:)?(?:0|3)0)?\\s*(?:a|p)m?)",location:"(?:(?:\\s+)(?:@?)(~))",position:"(?:(?:\\s*)((?:#?)(rest|barn|dtru)?)?\\s?(~))",time:"^(0?\\d|1(?:0|1|2))((?:(\\:)?)((?:0|3)0))?\\s*((?:a|p)m?)",qualifier:"(rest|barn|dtru)",comment:"(?:\\*\\*)([A-Za-z\\s]+)",sansmeridiem:"((?:1(?:0|1|2)|0?\\d)(?:(\\:)?(?:0|3)0)?\\s*(a|p|am|pm)?)\\s*-\\s*((?:1(?:0|1|2)|0?\\d)(?:(\\:)?(?:0|3)0)?\\s*(a|p|am|pm)?)"},Validator={isExcuse:function(t){var e=new RegExp(patterns.excusecode,"i");return e.test(t)},isTimes:function(t){var e=new RegExp(patterns.times,"i");return void 0!==typeof t&&e.test(t)},removeTimes:function(t){var e=new RegExp(patterns.times,"i");return t.replace(e,"")},hasLocation:function(t){let e=new RegExp(patterns.location,"i");return e.test(t)},removeLocation:function(t){let e=new RegExp(patterns.location,"i");return t.replace(e,"")},hasPosition:function(t){let e=new RegExp(patterns.position,"i");return e.test(t)},removePosition:function(t){let e=new RegExp(patterns.position,"i");return t.replace(e,"")},hasComment:function(t){let e=new RegExp(patterns.comment,"i");return e.test(t)},removeComment:function(t){let e=new RegExp(patterns.comment,"i");return t.replace(e,"")},hasMeridiem:function(t){let e=new RegExp(patterns.time,"i"),i=e.exec(t);return!!i[5]},properTime:function(t){let e=new RegExp(patterns.time,"i"),i=e.exec(t),s=i[1].startsWith("0")?i[1].replace("0",""):i[1],o=void 0===i[4]?"00":i[4],n=1===i[5].length?i[5]+"m":i[5];return s+":"+o+n},getTime:function(t){let e=new RegExp(patterns.times,"i"),i=e.exec(t);return{start:this.properTime(i[1]),end:this.properTime(i[3])}},getLocation:function(t){let e=new RegExp(patterns.location,"i"),i=e.exec(t);return i?i[1]:""},getPosition:function(t){let e=new RegExp(patterns.position,"i"),i=e.exec(t);if(i){let t,e;return i[2]&&(t=i[2]),e=i[3],{qualifier:t,position:e}}return{qualifier:"",position:""}},getComment:function(t){let e=new RegExp(patterns.comment,"i"),i=e.exec(t);return i?i[1]:""},getShiftTimes:function(t,e="2019-02-14"){let i=this.getTime(t),s=new moment(`${e} ${i.start}`,"YYYY-MM-DD hh:mm a"),o=new moment(`${e} ${i.end}`,"YYYY-MM-DD hh:mm a");return o.diff(s)<0&&o.add(1,"days"),{starttime:s,endtime:o}},validShift:function(t){if(this.isTimes(t)){let e=this.removeTimes(t);return this.hasLocation(e)&&(e=this.removeLocation(e)),this.hasPosition(e)&&(e=this.removePosition(e)),this.hasComment(e)&&(e=this.removeComment(e)),!e.trim()}return!!this.isExcuse(t)},validShifts:function(t){let e=t.split("/"),i=!0;for(let t=0;t<e.length;t++)i=i&&this.validShift(e[t]);if(i&&e.length>1){let t=this.getShiftTimes(e[0]),s=this.getShiftTimes(e[1]);s.starttime.diff(t.endtime)<0&&(i=!1)}return i}},rostershift={props:["schedule","employee"],template:'<input type="text"\n                spellcheck="false"\n                class="shift-input"  \n                :class="{missing :isEmpty, invalid :!isValid, tooshort :isTooShort, highlight :highlighted, onloan :isOnLoan, visiting :isVisiting, toolong :isTooLong, ousidenormalhours: isOutsideOpeningHours}"\n                v-model="schedule.shiftstring"\n                v-on:focusin="handleFocusIn" \n                v-on:focusout="handleFocusOut"   \n                v-on:change="valueChanged()"\n                v-on:keyup.enter="valueChanged()"\n                v-on:dblclick="emitEnterShift(schedule)"\n                v-on:mousedown="handleMouseDown"\n                v-on:mouseup="handleMouseUp"\n                v-on:keyup.arrow-right="handleArrowRight"\n                v-on:keyup.arrow-left="handleArrowLeft"\n                v-on:keyup.arrow-down="handleArrowDown"\n                v-on:keyup.arrow-up="handleArrowUp"\n                data-toggle="tooltip"\n                :title="title"/>',data:function(){return{highlighted:!1}},computed:{isEmpty:function(){return!this.schedule.shiftstring},isValid:function(){return this.isEmpty||Validator.validShifts(this.schedule.shiftstring)},row:function(){return parseInt(this.$parent.$el.getAttribute("data-row"))},col:function(){return parseInt(this.$parent.$el.getAttribute("data-col"))},isTooLong:function(){return!!(Validator.isTimes(this.schedule.shiftstring)&&this.schedule.hours()>data.getMaximumShift(this.schedule.firstShift.location))},isTooShort:function(){return!!(Validator.isTimes(this.schedule.shiftstring)&&this.schedule.hours()<data.getMinimumShift(this.schedule.firstShift.location))},isOnLoan:function(){return!("1"!==data.location.showloanedemployees||!Validator.isTimes(this.schedule.shiftstring)||this.employee.defaultLocation.toUpperCase()!==data.location.locID.toUpperCase()||!(this.schedule.firstShift&&this.schedule.firstShift.location.toUpperCase()!==data.location.locID.toUpperCase()||this.schedule.secondShift&&this.schedule.secondShift.location.toUpperCase()!==data.location.locID.toUpperCase()))},isVisiting:function(){return!("1"!==data.location.showvisitingemployees||!Validator.isTimes(this.schedule.shiftstring)||this.employee.defaultLocation.toUpperCase()===data.location.locID.toUpperCase()||!(this.schedule.firstShift&&this.schedule.firstShift.location.toUpperCase()===data.location.locID.toUpperCase()||this.schedule.secondShift&&this.schedule.secondShift.location.toUpperCase()===data.location.locID.toUpperCase()))},isOutsideOpeningHours:function(){return"0"!==data.location.showloanedemployees&&(this.isShiftOutsideOpeningHours(this.schedule.firstShift)||this.isShiftOutsideOpeningHours(this.schedule.secondShift))},title:function(){let t="";return this.isEmpty?t="Enter shift or excuse code":Validator.isExcuse(this.schedule.shiftstring)||Validator.validShifts(this.schedule.shiftstring)?this.isTooShort?this.schedule.firstShift&&(t=`Shift is shorter than ${data.getMinimumShift(this.schedule.firstShift.location)} hours`):this.isTooLong?this.schedule.firstShift&&(t=`Shift is greater than ${data.getMaximumShift(this.schedule.firstShift.location)} hours`):this.isOnLoan?t="Employee on loan":this.isVisiting?t=`Employee visiting from ${this.employee.defaultLocation.toUpperCase()}`:Validator.validShifts(this.schedule.shiftstring)&&(t=this.schedule.format("long",!1)):t="Invalid shift",this.isOutsideOpeningHours&&(t&&(t+="\r\n"),t+="Hours selected are outside the normal operating hours for location(s)"),t}},methods:{valueChanged:function(){for(let t of data.shortcuts)this.schedule.shiftstring.toLowerCase()===t.shortcut.toLowerCase()&&(this.schedule.shiftstring=t.replacement);this.checkMeridiem(this.schedule.shiftstring),this.isValid&&(this.schedule.setShifts(),this.schedule.format("short"),this.schedule.hours()>data.location.maximumshift&&EventBus.$emit("HOURS-EXCEEDED",{cell:{row:this.row,column:this.col},schedule:this.schedule})),this.schedule.isDirty=!0,this.emitChanged()},checkMeridiem:function(t){if(!this.isValid){let e,i=new RegExp(patterns.sansmeridiem,"i"),s=[t];do{e=i.exec(t),e&&(e[3]||(s=this.permutate(s,e[1])),e[6]||(s=this.permutate(s,e[4])),t=t.replace(i,""))}while(e);let o=[];for(let t of s)Validator.validShifts(t)&&o.push(t);let n=[];for(let t of o){let e=new Schedule(this.schedule.date);e.defaultLocation=this.schedule.defaultLocation,e.defaultPosition=this.schedule.defaultPosition,e.defaultQualifier=this.schedule.defaultQualifier,e.shiftstring=t,e.setShifts(),e.format("short"),this.isShiftOutsideOpeningHours(e.firstShift)||this.isShiftOutsideOpeningHours(e.secondShift)||n.push(e.shiftstring)}let l=[];for(let t of n){let e=new Schedule(this.schedule.date);e.defaultLocation=this.schedule.defaultLocation,e.defaultPosition=this.schedule.defaultPosition,e.defaultQualifier=this.schedule.defaultQualifier,e.shiftstring=t,e.setShifts(),e.format("short"),e.hours()<=data.getMaximumShift(e.defaultLocation)&&l.push(e.shiftstring)}0===l.length&&(l=n),1===l.length?this.schedule.shiftstring=l[0]:l.length>1&&EventBus.$emit("CHOOSE-SHIFT",{cell:{row:this.row,column:this.col},choices:l})}},permutate:function(t,e){let i=[];for(let s of t){let t="";e.endsWith(" ")&&(t=" "),i.push(s.replace(e,`${e.trim()}a${t}`)),i.push(s.replace(e,`${e.trim()}p${t}`))}return i},emitChanged:function(){this.$emit("cellchanged")},emitEnterShift:function(t){this.$emit("enter-shifts",t)},handleMouseDown:function(t){t.ctrlKey?this.highlighted=!0:t.shiftKey?EventBus.$emit("CELL-HIGHLIGHT-START",{row:this.row,column:this.col}):(3!==t.which||3===t.which&&!this.highlighted)&&EventBus.$emit("CELL-UNHIGHLIGHTED")},handleMouseUp:function(t){t.shiftKey&&EventBus.$emit("CELL-HIGHLIGHT-END",{row:this.row,column:this.col})},handleArrowRight:function(t){EventBus.$emit("ARROW-RIGHT",{row:this.row,column:this.col})},handleArrowLeft:function(t){EventBus.$emit("ARROW-LEFT",{row:this.row,column:this.col})},handleArrowDown:function(t){EventBus.$emit("ARROW-DOWN",{row:this.row,column:this.col})},handleArrowUp:function(t){EventBus.$emit("ARROW-UP",{row:this.row,column:this.col})},handleFocusIn:function(t){this.$emit("focusin"),EventBus.$emit("TOOK-FOCUS",{row:this.row,column:this.col})},handleFocusOut:function(t){this.$emit("focusout")},cut:function(){let t=this.$el;t.select(),document.execCommand("cut")&&this.valueChanged(),EventBus.$emit("CUTORCOPY",this.schedule.shiftstring)},copy:function(){let t=this.$el;t.select(),document.execCommand("copy"),EventBus.$emit("CUTORCOPY",this.schedule.shiftstring)},paste:function(){navigator.clipboard?navigator.clipboard.readText().then(t=>{this.schedule.shiftstring=t,this.valueChanged()}):data.clipboard&&(this.schedule.shiftstring=data.clipboard,this.valueChanged())},contextMenuClicked:function(t,e){let i=e.text();this.performContextMenuAction(i),EventBus.$emit("CONTEXTMENU-SELECTION",i)},performContextMenuAction:function(t){t=t.toLowerCase(),"cut"===t?this.cut():"copy"===t?this.copy():"paste"===t?this.paste():(this.schedule.shiftstring=t,this.schedule.setShifts(),this.schedule.format("short"),this.schedule.isDirty=!0,this.emitChanged())},onHighlightCell:function(t){this.row===t.row&&this.col===t.column&&(this.highlighted=!0)},onTakeFocus:function(t){t.row===this.row&&t.column===this.col&&(this.$el.focus(),EventBus.$emit("TOOK-FOCUS",t))},onChangeLocation:function(t){(this.highlighted||this.$parent.isActive)&&(this.schedule.changeLocation(t),this.schedule.setShifts(),this.schedule.format("short"),this.schedule.isDirty=!0,this.emitChanged())},onChangePosition:function(t){(this.highlighted||this.$parent.isActive)&&(this.schedule.changePosition(t),this.schedule.setShifts(),this.schedule.format("short"),this.schedule.isDirty=!0)},onSetExcuseCode:function(t){(this.highlighted||this.$parent.isActive)&&(this.schedule.shiftstring=t,this.schedule.setShifts(),this.schedule.format("short"),this.schedule.isDirty=!0,this.emitChanged())},isShiftOutsideOpeningHours:function(t){if(t){let e=data.getOpeningHours(t.location,t.date);if(!e.is_open)return!0;if(e.opening.subtract(data.getStartShiftBuffer(t.location),"minute"),e.closing.add(data.getEndShiftBuffer(t.location),"minute"),t.starttime.diff(e.opening)<0||t.endtime.diff(e.closing)>0)return!0}return!1},onShiftChosen:function(t){this.row===t.cell.row&&this.col===t.cell.column&&(this.schedule.shiftstring=t.shift,this.schedule.setShifts(),this.schedule.format("short"),this.schedule.isDirty=!0,this.emitChanged())}},mounted:function(){EventBus.$on("CELL-UNHIGHLIGHTED",()=>{this.highlighted=!1}),$(this.$el).contextMenu({menuSelector:"#contextMenu",menuSelected:this.contextMenuClicked}),EventBus.$on("CONTEXTMENU-SELECTION",t=>{this.highlighted&&this.performContextMenuAction(t)}),EventBus.$on("HIGHLIGHT-CELL",t=>{this.onHighlightCell(t)}),EventBus.$on("TAKE-FOCUS",t=>{this.onTakeFocus(t)}),EventBus.$on("CHANGE-LOCATION",t=>{this.onChangeLocation(t)}),EventBus.$on("CHANGE-POSITION",t=>{this.onChangePosition(t)}),EventBus.$on("SET-EXCUSECODE",t=>{this.onSetExcuseCode(t)}),EventBus.$on("MENUOPTION-SELECTION",t=>{(this.highlighted||this.$parent.isActive)&&this.performContextMenuAction(t)}),EventBus.$on("SHIFT-CHOSEN",t=>{this.onShiftChosen(t)})}},rostershiftcell={props:["schedule","employee"],template:'<td \n                ref="child"\n                class="col shift" \n                :class="{active :isActive, isclosed :!isOpen}" >\n                    <template v-if="allowEdit">\n                        <rostershift \n                            :schedule="schedule"\n                            :employee="employee"\n                            v-on:focusin="isActive = true" \n                            v-on:cellchanged="emitUpdateHours"\n                            v-on:enter-shifts="emitEnterShift">\n                        </rostershift>\n                    </template>\n                    <template v-else>\n                        <span class="readonly" :class="{isclosed :!isOpen}">{{schedule.shiftstring}}</span>\n                    </template>\n                    <span class="shift-read" v-html="readonlyFormat"></span>\n                </td>',components:{rostershift:rostershift},data:function(){return{isActive:!1}},computed:{firstShiftString:function(){this.schedule.firstShift&&this.schedule.firstShift.format("short")},secondShiftString:function(){if(this.schedule.secondShift)return this.schedule.secondShift.format("short")},row:function(){return parseInt(this.$el.getAttribute("data-row"))},col:function(){return parseInt(this.$el.getAttribute("data-col"))},isOpen:function(){return data.isOpen(data.location.locID,this.schedule.date)},allowEdit:function(){let t=!1;return data.roster&&"1"===data.roster.exportedToAcumen&&(t=!0),this.isOpen&&!t},readonlyFormat:function(){let t="";return this.schedule&&(this.schedule.isExcuse()?t=this.schedule.shiftstring:(this.schedule.firstShift&&(t=this.schedule.formatFirstShift("short",data.location.defaultQualifier)),this.schedule.secondShift&&(t=t+"/<br>"+this.schedule.formatSecondShift("short",data.location.defaultQualifier)))),t}},methods:{emitEnterShift:function(t){this.$emit("enter-shifts",t)},emitUpdateHours:function(){this.$emit("update-hours")},onTookFocus:function(t){t.row===this.row&&t.column===this.col||(this.isActive=!1)}},mounted:function(){EventBus.$on("TOOK-FOCUS",t=>{this.onTookFocus(t)})}},positionselector={props:["employee","schedules","positions","hasqualifier"],template:'<td class="col position">\n                    <template v-if="positions && positions.length > 1">\n                    <select v-model="selected" tabindex="-1">\n                        <option \n                            v-for="(position, index) in positions" \n                            :key="index"\n                            :value="position">{{position}}</option>\n                    </select>\n                    </template>\n                    <template v-else>\n                        <span>{{positions[0]}}</span>\n                    </template>\n               </td>',data:function(){return{selected:this.defaultPosition()}},watch:{selected:function(t,e){let i=t.split(" ");2===i.length?(this.employee.defaultQualifier=i[0],this.employee.defaultPosition=i[1]):this.employee.defaultPosition=i[0];for(let t of this.schedules)t.defaultQualifier=this.employee.defaultQualifier,t.defaultPosition=this.employee.defaultPosition,t.shiftstring&&t.format("short")}},methods:{defaultPosition:function(){let t=this.employee.defaultPosition;return null!==this.employee.defaultQualifier&&1===this.hasqualifier&&(t=`${this.employee.defaultQualifier} ${t}`),t}}},rosterslot={props:["employee","employeeindex","hasqualifier","positions"],data:function(){return{positionqualifiers:[],hours:0}},template:'<tr>\n                <td class="col rowheader">\n                    <span class="rownumber">{{employeeindex + 1}}</span>\n                    <button \n                        v-if="allowEdit"\n                        type="button" \n                        class="btn btn-xs" \n                        v-on:click="emitDeleteEmployee()"\n                        tabindex="-1"><span class="deleterow">x</span>\n                    </button>\n                </td>\n                <td \n                    class="col name" \n                    :class="{invalid :nameNotSet, gradeA :isGradeA, visiting :isVisiting}"\n                    v-on:dblclick="selectEmployee()"\n                >{{fullname}}</td>\n                <positionselector \n                    :employee="employee" \n                    :schedules="employee.schedules"   \n                    :positions="positions"\n                    :hasqualifier="hasqualifier">\n                </positionselector>\n                <rostershiftcell \n                    v-for="(schedule, index) in employee.schedules" \n                    :schedule="schedule" \n                    :employee="employee"\n                    :key="index"\n                    :data-row="employeeindex + 1"\n                    :data-col="index + 1"\n                    v-on:update-hours="updatehours()"\n                    v-on:enter-shifts="emitEnterShift">\n                </rostershiftcell>\n                <td class="col hours number" :class="{invalid: !hoursMeetMinimum}" tabindex="-1" data-toggle="tooltip" :title="hoursTitle">{{hours}}</td>\n               </tr>',components:{rostershiftcell:rostershiftcell,positionselector:positionselector},computed:{fullname:function(){let t=`${this.employee.emp_fname} ${this.employee.emp_lname}`;return this.isVisiting&&t.trim()&&(t+=` (${this.employee.defaultLocation.toUpperCase()})`),t},position:function(){let t=this.employee.defaultPosition;return null!==this.employee.defaultQualifier&&1===this.hasqualifier&&(t=`${this.employee.defaultQualifier} ${t}`),t},nameNotSet:function(){return""===this.fullname.trim()},isGradeA:function(){return"1"===this.employee.classA},hoursMeetMinimum:function(){if(0===this.hours)return!0;{let t=parseInt(data.location.minimumhours);return this.isGradeA&&(t=parseInt(data.location.maximumhours)),!(this.hours<t)}},isVisiting:function(){return"1"===data.location.showvisitingemployees&&this.employee.defaultLocation.toUpperCase()!==data.location.locID.toUpperCase()},hoursTitle:function(){let t=parseInt(data.location.minimumhours);return this.isGradeA&&(t=parseInt(data.location.maximumhours)),this.hours<t?`Less than the employee's miniumum ${t} hours`:""},allowEdit:function(){let t=!1;return data.roster&&"1"===data.roster.exportedToAcumen&&(t=!0),!t}},methods:{noMissingCells:function(){let t=0;for(let e in this.employee.schedules)this.employee.schedules[e].isEmpty()&&(t+=1);return t},noInvalidCells:function(){let t=0;for(let e in this.employee.schedules)this.employee.schedules[e].isValid()||(t+=1);return""===this.fullname.trim()&&(t+=1),this.hoursMeetMinimum||(t+=1),t},updatehours:function(){this.hours=0;for(let t in this.employee.schedules)this.hours+=this.employee.schedules[t].hours();this.employee.hours=this.hours,this.employee.noMissingCells=this.noMissingCells(),this.employee.noInvalidCells=this.noInvalidCells(),this.$emit("hours-updated")},emitDeleteEmployee:function(){this.$emit("delete-employee",this.employeeindex)},emitEnterShift:function(t){this.$emit("enter-shifts",{schedule:t,employee:this.employee})},selectEmployee:function(){this.allowEdit&&this.$emit("select-employee",this.employeeindex)}},mounted(){this.updatehours(),EventBus.$on("SCHEDULE-UPDATED",()=>{this.updatehours()})}},rostersection={props:["section","employees","qualifiers","positions"],template:'<div v-bind:data-sectionID="section.id">\n                <table class="title table-bordered">\n                    <tbody>\n                        <tr>\n                            <td>{{section.name}}\n                                <span>\n                                    <button \n                                        v-if="allowEdit"\n                                        type="button" \n                                        class="btn btn-sm btn-add" \n                                        v-on:click="emitAddEmployee()"\n                                        tabindex="-1">Add\n                                    </button>\n                                </span>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n                <table class="details table-bordered">\n                    <tbody>\n                        <rosterslot \n                            class="rosterrow" \n                            v-for="(employee, index) in employees"\n                            v-if="employee.sectionsDefID === section.id" \n                            :employee="employee"\n                            :key="index"\n                            :employeeindex="index"\n                            :positions="positions"\n                            :hasqualifier = "hasQualifier"\n                            v-on:hours-updated="hoursUpdated()"\n                            v-on:delete-employee="emitDeleteEmployee"\n                            v-on:select-employee="emitSelectEmployee"\n                            v-on:enter-shifts="emitEnterShifts">\n                        </rosterslot>\n                    </tbody>\n                </table>\n               </div>',components:{rosterslot:rosterslot},computed:{hasQualifier:function(){return this.qualifiers.length>0?1:0},allowEdit:function(){let t=!1;return data.roster&&"1"===data.roster.exportedToAcumen&&(t=!0),!t}},methods:{emitAddEmployee:function(){this.$emit("add-employee",this.section)},emitDeleteEmployee:function(t){this.$emit("delete-employee",t)},emitSelectEmployee:function(t){this.$emit("select-employee",t)},hoursUpdated:function(){this.$emit("hours-updated")},emitEnterShifts(t){this.$emit("enter-shifts",t)}}},timeentry={props:{value:String,start:moment,end:moment},data:function(){return{times:[],selectedvalue:this.value,valueindex:0}},watch:{value:function(t){this.selectedvalue=this.value},start:function(t,e){e&&0===t.diff(e)||this.loadTimes()},end:function(t,e){e&&0===t.diff(e)||this.loadTimes()}},template:'<select class="form-control" v-model="selectedvalue" v-on:change="emitTimeChanged">\n                    <option value="" disabled >Select time</option>\n                    <option v-for="(time, index) in times" :key="index" :value="time">{{getDisplayedTime(time)}}</option>\n               </select>',
methods:{emitTimeChanged:function(){this.$emit("time-changed",this.selectedvalue)},setStart:function(t){this.start=t},setValueIndex:function(){this.valueindex=this.times.indexOf(this.selectedvalue)},addTime:function(t){this.times.push(t)},loadTimes:function(){if(this.times=[],this.start&&this.end){let t=moment(this.start);for(;t.diff(this.end)<0;)this.addTime(t.format("h:mm a")),t=t.add(30,"m")}this.setValueIndex()},getDisplayedTime:function(t){let e=t;switch(t){case"12:00 am":e="Midnight";break;case"12:00 pm":e="Noon"}return e},validIndex:function(t){return t>=this.valueindex}},created:function(){this.loadTimes()}},shiftentry={props:["location","employee","schedule","locations","locationsqualifiers"],data:function(){return{showModal:"none",localSchedule:this.createSchedule(this.schedule),locID:this.location.locID,page:1,isSplit:!1,errors:{starttime:!1,endtime:!1,position:!1,has:function(){return!!(this.starttime||this.endtime||this.position)}},starttimestart:null,starttimeend:null,endtimestart:null,endtimeend:null}},components:{timeentry:timeentry},watch:{locID:function(t,e){this.currentShift.location=t,this.calculateAllTimes()},isSplit:function(t){t?this.localSchedule.secondShift||(this.localSchedule.secondShift=this.createShift()):this.localSchedule.secondShift=null}},computed:{dateDisplay:function(){return this.localSchedule.date.format("dddd MMMM DD, YYYY")},fullname:function(){return`${this.employee.emp_fname} ${this.employee.emp_lname}`},currentShift:function(){let t;return 1===this.page?(this.localSchedule.firstShift||(this.localSchedule.firstShift=this.createShift()),t=this.localSchedule.firstShift):(this.localSchedule.secondShift||(this.localSchedule.secondShift=this.createShift()),t=this.localSchedule.secondShift),t},previousShift:function(){return 1===this.page?null:this.localSchedule.firstShift},currentPosition:{get:function(){return 1===this.page?this.localSchedule.firstShift.position?this.getShiftPosition(this.localSchedule.firstShift):this.getEmployeePosition():this.localSchedule.firstShift.position?this.getShiftPosition(this.localSchedule.secondShift):this.getEmployeePosition()},set:function(t){let e=Validator.getPosition(t);1===this.page?(this.localSchedule.firstShift.qualifier=e.qualifier,this.localSchedule.firstShift.position=e.position):(this.localSchedule.secondShift.qualifier=e.qualifier,this.localSchedule.secondShift.position=e.position),this.localSchedule.format("short")}},shiftstring:function(){return this.localSchedule.format("short"),this.localSchedule.shiftstring},isValid:function(){return Validator.validShifts(this.shiftstring)}},template:'<div id="shiftentry-dialog" class="modal fade" tabindex=-1 role="dialog">\n                    <div class="modal-dialog" role="document">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <button type="button" class="close" data-dismiss="modal" aria-label="Close" v-on:click="reset"><span aria-hidden="true">&times;</span></button>\n                                <h4 class="modal-title">Enter shift for {{fullname}}<span v-if="isSplit">&nbsp;(Shift {{page}} of 2)</span></h4>\n                                <h5 class="modal-title">Date: {{dateDisplay}}</h5>\n                                <h5 class="haserrors" v-show="errors.has()"><span><strong>The fields marked red are required</strong></span></h5>\n                            </div>\n                            <div class="modal-body">\n                                <div v-if="(page===1 && (currentShift.starttime && currentShift.endtime)) || page===2">\n                                    <p><span>Shift string:&nbsp;</span>{{shiftstring}}</p>\n                                </div>\n                                <div class="form-group row">\n                                    <div class="col-xs-6">\n                                        <label for="location">Location</label>\n                                        <select id="location" v-model="locID" class="form-control">\n                                            <option v-for="loc in locations" v-if="isValidRosteredAtLocation(loc)" :value="loc.locID">{{loc.name}}</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="form-group row">\n                                    <div class="col-xs-4" :class="{haserrors: errors.starttime}">\n                                        <label for="starttime">Start Time<span v-show="errors.location"><strong>&nbsp;&#10033;</strong></span></label>\n                                        <timeentry \n                                            ref="starttime" \n                                            id="starttime" \n                                            :value="gettime(currentShift.starttime)" \n                                            :start="starttimestart"\n                                            :end="starttimeend"\n                                            v-on:time-changed="setStartTime"/>\n                                    </div>\n                                    <div class="col-xs-4" :class="{haserrors: errors.endtime}">\n                                        <label for="endtime">End Time<span v-show="errors.location"><strong>&nbsp;&#10033;</strong></span></label>\n                                        <timeentry \n                                            ref="endtime" \n                                            id="endtime" \n                                            :value="gettime(currentShift.endtime)" \n                                            :start="endtimestart" \n                                            :end="endtimeend"\n                                            v-on:time-changed="setEndTime"/>\n                                    </div>\n                                    <div class="col-xs-4">\n                                        <label for="hours">Hours</label>\n                                        <p v-if="(currentShift.starttime && currentShift.endtime) || page===2">{{localSchedule.hours()}}</p>\n                                    </div>\n                                </div>\n                                <div class="form-group row">\n                                    <div class="col-xs-6">\n                                        <label for="position" :class="{haserrors: errors.position}">Position<span v-show="errors.location"><strong>&nbsp;&#10033;</strong></span></label>\n                                        <template v-if="location.positionfixed===\'0\'">\n                                            <select id="position" v-model="currentPosition" class="form-control">\n                                                <option value="" disabled>Select position</option>\n                                                <option v-for="row in locationsqualifiers" v-if="row.locID===locID" :value="row.position">{{row.position}}</option>\n                                            </select>\n                                        </template>\n                                        <template v-else>\n                                            <input class="form-control" type="text" v-model="currentPosition" readonly />\n                                        </template> \n                                    </div>\n                                </div>\n                                <div class="form-group">\n                                    <label for="comment">Comment</label>\n                                    <input type="text" id="comment" class="form-control" v-model="currentShift.comment"/>\n                                </div>\n                                <div class="form-group">\n                                    <input type="checkbox" id="issplit" v-model="isSplit">\n                                    <label for="issplit">Is split shift?</label>\n                                </div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-default" data-dismiss="modal" v-on:click="reset">Close</button>\n                                <button type="button" class="btn btn-default" v-on:click="gotoPageOne" v-if="isSplit && page===2">&lt; 1st shift</button>\n                                <button type="button" class="btn btn-default" v-on:click="gotoPageTwo" v-if="isSplit && page===1">2nd shift &gt;</button>\n                                <button type="button" class="btn btn-primary" v-on:click="selectshiftOkClicked" :disabled="!isValid">OK</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>',methods:{openingtimes:function(){return data.getOpeningHours(this.locID,this.localSchedule.date)},updateData:function(t){this.localSchedule=this.createSchedule(t.schedule),this.locID=this.location.locID,1===this.page?t.schedule.firstShift&&(this.locID=t.schedule.firstShift.location):t.schedule.secondShift&&(this.locID=t.schedule.secondShift.location),this.validate()},createSchedule:function(t){let e=new Schedule(t.date);return e.firstShift=t.firstShift,e.secondShift=t.secondShift,this.isSplit=t.isSplit(),e},isValidStartTime:function(){let t=!0;return this.currentShift.starttime?this.errors.starttime=!1:(t=!1,this.errors.starttime=!0),t},isValidEndTime:function(){let t=!0;return this.currentShift.endtime?this.errors.endtime=!1:(t=!1,this.errors.endtime=!0),t},isValidPosition:function(){let t=!0;return this.currentShift.position?this.errors.position=!1:(t=!1,this.errors.position=!0),t},validate:function(){let t=this.isValidStartTime();return t=this.isValidEndTime()&&t,t=this.isValidPosition()&&t,t},selectshiftOkClicked:function(){this.validate()&&(hideShiftEntryModal(),this.localSchedule.format("short"),this.localSchedule.shiftstring!==this.schedule.shiftstring&&(this.schedule.isDirty=!0),this.schedule.shiftstring=this.localSchedule.shiftstring,this.schedule.setShifts(),this.schedule.format("short"),this.emitScheduleUpdated(),this.reset())},emitScheduleUpdated:function(){EventBus.$emit("SCHEDULE-UPDATED")},gotoPageTwo:function(){this.validate()&&(this.page=2,this.resetErrors(),this.validate(),this.calculateAllTimes())},gotoPageOne:function(){this.page=1,this.resetErrors(),this.validate(),this.calculateAllTimes()},resetErrors:function(){this.errors.starttime=!1,this.errors.endtime=!1,this.errors.position=!1},gettime:function(t){return t?t.format("h:mm a"):""},setStartTime:function(t){this.currentShift.starttime=new moment(`${this.schedule.date.format("YYYY-MM-DD")} ${t}`,"YYYY-MM-DD h:mm a"),this.isValidStartTime(),this.calculateEndTime()},setEndTime:function(t){this.currentShift.endtime=new moment(`${this.schedule.date.format("YYYY-MM-DD")} ${t}`,"YYYY-MM-DD h:mm a"),this.currentShift.endtime.diff(this.currentShift.starttime)<=0&&this.currentShift.endtime.add(1,"days"),this.isValidEndTime()},createShift:function(){let t=new Shift(this.schedule.date);return t.location=this.location.locID,t.qualifier=this.employee.defaultQualifier,t.position=this.employee.defaultPosition,t},reset:function(){this.page=1,this.isSplit=!1},hoursUpdated:function(){this.$emit("hours-updated")},getEmployeePosition:function(){let t;return t=this.employee.defaultQualifier?`${this.employee.defaultQualifier} ${this.employee.defaultPosition}`:this.employee.defaultPosition,t},getShiftPosition:function(t){let e;return e=t.qualifier?`${t.qualifier} ${t.position}`:t.position,e},isValidRosteredAtLocation:function(t){let e=new RegExp(this.location.rosteredat,"gi");return e.test(t.type)},calculatePageOneStartTimeBegin:function(){let t=this.openingtimes().opening.subtract(data.getStartShiftBuffer(this.locID),"minute");this.starttimestart=t},calculatePageOneStartTimeEnd:function(){this.starttimeend=this.openingtimes().closing.add(data.getEndShiftBuffer(this.locID),"minute").subtract(data.getMinimumShift(this.locID),"hour")},calculatePageOneEndTimeBegin:function(){let t=this.openingtimes().opening.subtract(data.getStartShiftBuffer(this.locID),"minute").add(data.getMinimumShift(this.locID),"hour");this.endtimestart=t,this.localSchedule.firstShift.starttime&&(this.endtimestart=moment(this.localSchedule.firstShift.starttime).add(data.getMinimumShift(this.locID),"hour"))},calculatePageOneEndTimeEnd:function(){if(this.endtimeend=this.openingtimes().closing.add(data.getEndShiftBuffer(this.locID),"minute"),this.localSchedule.firstShift.starttime)return moment(this.localSchedule.firstShift.starttime).add(data.getMaximumShift(this.locID),"hour")},calculatePageTwoStartTimeBegin:function(){let t=moment(this.localSchedule.firstShift.endtime).add(60,"minute");this.starttimestart=t},calculatePageTwoStartTimeEnd:function(){this.starttimeend=this.openingtimes().closing.add(data.getEndShiftBuffer(this.locID),"minute")},calculatePageTwoEndTimeBegin:function(){let t=moment(this.localSchedule.firstShift.endtime).add(60,"minute");this.endtimestart=t},calculatePagetwoEndTimeEnd:function(){this.endtimeend=this.openingtimes().closing.add(data.getEndShiftBuffer(this.locID),"minute"),this.localSchedule.secondShift.starttime&&(this.endtimeend=moment(this.localSchedule.secondShift.starttime).add(data.getMaximumShift(this.locID),"h").substract(this.localSchedule.firstShift.hours(),"hour"))},calculateStartTime:function(){1===this.page?(this.calculatePageOneStartTimeBegin(),this.calculatePageOneStartTimeEnd()):(this.calculatePageTwoStartTimeBegin(),this.calculatePageTwoStartTimeEnd())},calculateEndTime:function(){1===this.page?(this.calculatePageOneEndTimeBegin(),this.calculatePageOneEndTimeEnd()):(this.calculatePageTwoEndTimeBegin(),this.calculatePageTwoEndTimeEnd())},calculateAllTimes:function(){this.calculateStartTime(),this.calculateEndTime()}},mounted(){EventBus.$on("SHOW-SHIFTENTRYMODAL",t=>{this.updateData(t),this.calculateAllTimes()})}},genericdialog={props:{showCancel:Boolean,handle:String,title:String,secondarytitle:String},template:'<div v-bind:id="handle" class="modal fade" tabindex=-1 role="dialog">\n                <div class="modal-dialog" role="document">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button v-if="showCancel" type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                            <h4 class="modal-title">{{title}}</h4>\n                            <h5 class="modal-title">{{secondarytitle}}</h5>\n                        </div>\n                        <div class="modal-body">\n                            <slot name="body">Default Value</slot>\n                        </div>\n                        <div class="modal-footer">\n                            <button v-if="showCancel" type="button" class="btn btn-default" data-dismiss="modal">Close</button>\n                            <slot name="btn_ok"></slot>\n                        </div>\n                    </div>\n                </div>\n            </div>'},selectiondialog={props:{showCancel:Boolean,handle:String,title:String,secondarytitle:String,searchtext:String},components:{genericdialog:genericdialog},template:'<genericdialog\n                    class="selectsearch-dialog"\n                    :handle="handle"\n                    :title="title"\n                    :secondarytitle="secondarytitle"\n                    :show-cancel="showCancel">\n                        <template slot="body">\n                            <input type="text" v-model="searchtext" v-on:input="$emit(\'input\',searchtext)">\n                            <ul>\n                                <slot name="elements"></slot>\n                            </ul>\n                        </template>\n                </genericdialog>'},selectemployee={props:["deletedemployees","otheremployees"],data:function(){return{searchText:"",selectedEmployee:null}},components:{selectiondialog:selectiondialog},template:'<selectiondialog\n                    handle="selectemployee-dialog"\n                    title="Select an employee"\n                    secondarytitle="Double click to select"\n                    :searchtext="searchText"\n                    show-cancel\n                    v-on:input="searchTextChanged">\n                    <template slot="elements">\n                        <li \n                            class="local"\n                            v-for="employee in deletedemployees" \n                            v-if="deletedemployees.length > 0"\n                            v-show="matchesSearch(employee)"\n                            v-on:dblclick="employeeDblClicked(employee)">{{fullnameandnumber(employee)}}</li>\n                        <li \n                            v-for="other in otheremployees"\n                            v-if="otheremployees.length > 0"\n                            v-show="matchesSearch(other)"\n                            v-on:dblclick="visitingEmployeeDblClicked(other)">{{fullnamenumberandposition(other)}}</li>\n                    </template>\n                </selectiondialog>',methods:{searchTextChanged:function(t){this.searchText=t},fullname:function(t){return`${t.emp_fname} ${t.emp_lname}`},fullnameandnumber:function(t){return`${t.emp_fname} ${t.emp_lname} (${t.emp_no})`},fullnamenumberandposition:function(t){return`${t.emp_fname} ${t.emp_lname} (${t.emp_no}) (${t.position})`},matchesSearch:function(t){let e=this.fullname(t);return e.toLowerCase().includes(this.searchText.toLowerCase())},employeeDblClicked:function(t){this.selectedEmployee=t,this.emitEmployeeSelected(t)},visitingEmployeeDblClicked:function(t){t.visitor=!0,this.employeeDblClicked(t)},emitEmployeeSelected:function(t){this.searchText="",this.$emit("employee-selected",t)}}},selectshift={props:["choices"],components:{genericdialog:genericdialog},template:'<genericdialog\n                    class="selectshifts-dialog"\n                    title="Ambigious shift string provided. Please select correct shift."\n                    secondarytitle="Double click to select"\n                    show-cancel>\n                        <template slot="body">\n                        <li \n                            v-for="shift in choices"\n                            v-on:dblclick="shiftselected(shift)">{{shift}}</li>\n                        </template>\n                </genericdialog>',methods:{shiftselected:function(t){this.$emit("shift-selected",t)}}},copyfromroster={props:["approvedrosters"],data:function(){return{searchText:""}},components:{selectiondialog:selectiondialog},template:'<selectiondialog\n                    handle="selectroster-dialog"\n                    title="Select a week to copy the roster from"\n                    secondarytitle="Double click to selct"\n                    :searchtext="searchText"\n                    show-cancel\n                    v-on:input="searchTextChanged">\n                    <template slot="elements">\n                        <template v-if="approvedrosters.length > 0">\n                            <li\n                                v-for="roster in approvedrosters"\n                                v-show="matchesSearch(roster)"\n                                v-on:dblclick="rosterSelected(roster)">{{displayWeek(roster)}}</li>\n                        </template>\n                        <template v-else>\n                            <p>There are no approved rosters to copy from</p>\n                        </template>\n                    </template>\n                </selectiondialog>',methods:{searchTextChanged:function(t){this.searchText=t},matchesSearch:function(t){let e=this.displayWeek(t);return e.toLowerCase().includes(this.searchText.toLowerCase())},displayWeek:function(t){return moment(t.weekending,"YYYY-MM-DD").format("dddd MMM D, YYYY")},rosterSelected:function(t){this.searchText="",this.$emit("copyfromweekending",t)}}},maxhoursexceeded={props:["hours","shiftstring","cell"],components:{genericdialog:genericdialog},template:'<genericdialog\n                    handle="maximumhoursexceeded"\n                    :title="title">\n                    <template slot="body">\n                        <div class="form-group">\n                            <p>{{message}}</p>\n                            <p>Are you sure you want to continue?</p>\n                        </div>\n                    </template>\n                    <template slot="btn_ok">\n                        <button type="button" class="btn btn-default" v-on:click="closeDialog">Close</button>\n                        <button type="button" class="btn btn-primary" v-on:click="maximumhoursviolated_okclicked">Edit</button>\n                    </template>\n                </genericdialog>',computed:{title:function(){return`Shift is more than ${this.hours} hours`},message:function(){return`The shift ${this.shiftstring} is more than ${this.hours} hours in length.`}},methods:{maximumhoursviolated_okclicked:function(){this.closeDialog(),EventBus.$emit("TAKE-FOCUS",this.cell)},closeDialog:function(){$(this.$el).modal("hide")}}};const app=new Vue({el:"#main",data:{options:null,roster:null,locations:null,sections:null,employees:null,savedschedules:null,positionQualifiers:null,excusecodes:null,location:null,locID:"",weekending:null,weekstarting:null,positions:[],nomissingcells:0,noinvalidcells:0,totalhours:0,loanedhours:0,agreedhours:0,additionalhours:0,deletedemployees:[],deletedEmployeeIDs:[],otheremployees:[],editEmployeeIndex:-1,editdata:null,locationsqualifiers:[],disabledDates:{days:[0,1,3,4,5,6]},errors:{location:!1,weekending:!1,has:function(){return!(!this.location&&!this.weekending)}},contextMenuEnabled:!1,highlight:{start:null,end:null},approvedrosters:[],hoursexceeded:0,hoursexceeded_shiftstring:"",hoursexceeded_cell:null,acumenexport:{title:"",body:""},showdrafttext:!0,noemployees:0,noshifts:0,noexcusecodes:0,shortcuts:[],schedulesloaded:!1,texttopaste:!1,shiftchoices:{cell:null,choices:null}},components:{rostersection:rostersection,selectemployee:selectemployee,shiftentry:shiftentry,datepicker:vuejsDatepicker,genericdialog:genericdialog,selectiondialog:selectiondialog,copyfromroster:copyfromroster,maxhoursexceeded:maxhoursexceeded,selectshift:selectshift},watch:{roster:function(t){t&&"1"===t.exportedToAcumen&&autoSave&&(clearInterval(autoSave),console.log("Cancelling auto save")),data.roster=t},locations:function(){this.setLocationsRegExPattern();let t=this.$el.querySelector("#locID").value,e=this.$el.querySelector("#weekending").value;if(t&&(this.locID=t),e){let t=e.split("-"),i=parseInt(t[0]),s=parseInt(t[1])-1,o=parseInt(t[2]);this.weekending=new Date(i,s,o)}this.locID&&this.weekending?(this.setWeekstarting(),this.setLocation()):(this.validate(),showStartupModal())},location:function(t){if(t){data.location=t;let e=this.loadOpeningHours(),i=this.loadPositionQualifiers(),s=this.loadRoster(),o=this.loadSections(),n=this.loadAllocatedHours(),l=this.loadPositions(),h=this.loadOtherEmployees(),r=this.loadLocationsQualifiers(),a=this.loadExcuseCodes(),c=this.loadShortcuts(),d=this.loadApprovedRosters();Promise.all([e,i,s,o,n,l,h,r,a,c,d]).then(()=>{this.loadEmployees(),document.title=`${this.location.name} Roster weekending ${this.weekendingDisplay}`})}},employees:function(t,e){t&&this.createEmployeeSchedules()},savedschedules:function(t,e){t&&this.showSavedEmployeeSchedules()},excusecodes:function(){this.setExcuseCodesRegExPattern()},options:function(t){if(t){let t=this.getOptionValue("savefrequency");t&&(t=parseInt(t)),0!==t&&(autoSave=window.setInterval(()=>{this.saveRoster(),console.log("Auto saved")},t))}}},computed:{difference:function(){return this.agreedhours+this.additionalhours-this.totalhours},weekendingDisplay:function(){return moment(this.formatWeekending(),"MM/DD/YYYY").format("dddd MMM D, YYYY")},month:function(){return moment(this.formatWeekending(),"MM/DD/YYYY").format("MMMM")},exportedToAcumen:function(){return!(!this.roster||"1"!==this.roster.exportedToAcumen)},rosterURL:function(){let t=this.getOptionValue("url");if(t){let e=moment(this.formatWeekending(),"MM/DD/YYYY").format("YYYY-MM-DD");return t=`${t}?locid=${this.location.locID}&weekending=${e}`,t}return null}},methods:{getOptionValue:function(t){if(this.options)for(let e of this.options)if(e.name.toLowerCase()===t.toLowerCase())return e.value;return null},clipboardEmpty:function(){return!this.texttopaste},setLocationsRegExPattern:function(){let t="";for(let e=0;e<this.locations.length;e++)e>0&&(t+="|"),t+=this.locations[e].locID;patterns.location=patterns.location.replace("~",t)},setExcuseCodesRegExPattern:function(){let t="";if(this.excusecodes){for(let e=0;e<this.excusecodes.length;e++)"0"===this.excusecodes[e].isoff&&(t&&(t+="|"),t+=this.excusecodes[e].code);patterns.excusecode=patterns.excusecode.replace("~",t)}},updatestats:function(){if(this.employees){for(employee of(this.nomissingcells=0,this.noinvalidcells=0,this.noshifts=0,this.noexcusecodes=0,this.employees))for(schedule of(employee.noMissingCells&&(this.nomissingcells+=employee.noMissingCells),employee.noInvalidCells&&(this.noinvalidcells+=employee.noInvalidCells),employee.schedules))schedule.shiftstring&&(Validator.isExcuse(schedule.shiftstring)?this.noexcusecodes+=1:schedule.isSplit()?this.noshifts+=2:this.noshifts+=1);this.noemployees=this.employees.length}},deleteEmployee:function(t){let e=this.employees[t];e.emp_no&&(e.visitor?(this.otheremployees.push(e),this.otheremployees.sort(this.sortEmployees)):(this.deletedemployees.push(e),this.deletedemployees.sort(this.sortEmployees))),this.employees[t].id&&this.employees[t].id>0&&this.deletedEmployeeIDs.push(this.employees[t].id),this.employees.splice(t,1),this.updatestats()},hoursUpdated:function(){if(this.totalhours=0,this.loanedhours=0,this.employees)for(let t of this.employees)for(let e of t.schedules){if(e.firstShift){let t=e.firstShift.hours();e.firstShift.isOnLoan&&"1"===this.location.showloanedemployees?this.loanedhours+=t:this.totalhours+=t}if(e.secondShift){let t=e.secondShift.hours();e.secondShift.isOnLoan&&"1"===this.location.showloanedemployees?this.loanedhours+=t:this.totalhours+=t}}this.updatestats()},weekDate:function(t){let e=t-7;return moment(this.formatWeekending(),"MM/DD/YYYY").add(e,"days")},displayDayNameLong:function(t){let e=t-7,i=moment(this.formatWeekending(),"MM/DD/YYYY").add(e,"days");return i.format("dddd")},displayDayNameShort:function(t){let e=t-7,i=moment(this.formatWeekending(),"MM/DD/YYYY").add(e,"days");return i.format("ddd")},displayDayDate:function(t){let e=t-7,i=moment(this.formatWeekending(),"MM/DD/YYYY").add(e,"days");return 1===t||1===i.date()?i.format("MMM D"):i.format("D")},createEmployeeSchedules:function(){for(let t of this.employees)t.schedules||this.$set(t,"schedules",this.createSchedules(t))},showSavedEmployeeSchedules:function(){for(let t of this.savedschedules){let e=this.findEmployeeByEmpNo(t.emp_no),i=this.findScheduleIndexByWeekDate(t.date);if(e&&null!==i){let s=e.schedules[i];s.id=t.id,s.rosterID=t.rosterID,s.shiftstring=t.shiftstring,s.setShifts(),s.format("short")}}this.schedulesloaded=!0,this.emitScheduleUpdated()},findEmployeeByEmpNo:function(t){let e=null;for(let e of this.employees)if(e.emp_no===t)return e;return e},findEmployeeIndexByEmpNo:function(t){let e=-1;for(let e=0;e<this.employees.length;e++)if(this.employees[e].emp_no===t)return e;return e},findScheduleIndexByWeekDate:function(t){for(let e=0;e<7;e++)if(this.weekDate(e+1).format("YYYY-MM-DD")===t)return e;return null},createSchedule:function(t,e){let i=new Schedule(t);return i.id="0",i.defaultLocation=this.location.locID,i.defaultQualifier=e.defaultQualifier,i.defaultPosition=e.defaultPosition,i.isDirty=!1,i.shiftstring="",data.isOpen(this.location.locID,i.date)||(i.shiftstring="OFF",i.isDirty=!0),i},createSchedules:function(t){return[this.createSchedule(this.weekDate(1),t),this.createSchedule(this.weekDate(2),t),this.createSchedule(this.weekDate(3),t),this.createSchedule(this.weekDate(4),t),this.createSchedule(this.weekDate(5),t),this.createSchedule(this.weekDate(6),t),this.createSchedule(this.weekDate(7),t)]},getAddIndex:function(t){let e=this.employees.length,i=!1;for(let s=0;s<this.employees.length;s++)if(this.employees[s].sectionsDefID===t&&(i=!0),i&&this.employees[s].sectionsDefID!==t){e=s;break}return e},addEmployee:function(t){let e={id:0,emp_no:"",emp_fname:"",emp_lname:"",gender:"",defaultPosition:t.defaultPosition,defaultQualifier:this.location.defaultQualifier,sectionsDefID:t.id,defaultLocation:""};e.schedules=this.createSchedules(this.location.defaultQualifier,t.defaultPosition);let i=this.getAddIndex(t.id);this.employees.splice(i,0,e)},getQualifiers:function(t){let e=[];for(let i in this.positionQualifiers)this.positionQualifiers[i].Code===t&&e.push(this.positionQualifiers[i]);return e},loadRoster:function(){let t=`getroster.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{1===t.length&&(this.roster=t[0])})},loadSections:function(){let t=`getsections.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{this.sections=t})},loadEmployees:function(){let t=`getemployees.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;fetch(t).then(t=>t.json()).then(t=>{this.employees=t,this.loadRosterSchedules()})},loadPositionQualifiers:function(){let t=`getpositionqualifiers.php?locID=${this.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{this.positionQualifiers=t})},loadAllocatedHours:function(){let t=`getallocatedhours.php?locID=${this.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{this.agreedhours=parseFloat(t[0].allocatedhours),this.additionalhours=parseFloat(t[0].additionalhours)})},loadPositions:function(){let t=`getpositions.php?locID=${this.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{this.extractPositions(t)})},loadOtherEmployees:function(){let t=`getotheremployees.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{t&&(this.otheremployees=t)})},loadLocationsQualifiers:function(){let t=`getlocationsqualifiers.php?weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{t&&(this.locationsqualifiers=t)})},loadRosterSchedules:function(){let t=`getrosterschedules.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;fetch(t).then(t=>t.json()).then(t=>{t&&(this.savedschedules=t)})},loadRosterSchedulesFromCopy:function(t){url=`getrosterschedules.php?locID=${this.location.locID}&weekstarting=${t.format("YYYY-MM-DD")}&copyto=${this.weekstarting.format("YYYY-MM-DD")}`,fetch(url).then(t=>t.json()).then(t=>{t&&this.updateSchedules(t)})},loadExcuseCodes:function(){let t="getexcusecodes.php";return fetch(t).then(t=>t.json()).then(t=>{this.excusecodes=t})},loadShortcuts:function(){let t=`getshortcuts.php?locID=${this.location.locID}`;return fetch(t).then(t=>t.json()).then(t=>{this.shortcuts=t,data.shortcuts=t})},loadApprovedRosters:function(){let t=`getapprovedrosters.php?locID=${this.location.locID}`;return fetch(t).then(t=>t.json()).then(t=>{this.approvedrosters=t})},loadOpeningHours:function(){let t=`getopeninghours.php?weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return fetch(t).then(t=>t.json()).then(t=>{data.openinghours=t})},approveRoster:function(){let t=`approveroster.php?id=${this.roster.id}`;fetch(t)},saveRoster:function(t=!1,e=!1){
let i=`saveroster.php?locID=${this.location.locID}&weekstarting=${this.weekstarting.format("YYYY-MM-DD")}`;return t&&(i+="&exporttoacumen=1"),fetch(i).then(t=>t.json()).then(t=>{t&&this.loadRoster().then(()=>{this.completeRosterSave().then(()=>{this.acumenexport.title="Save succeeded",this.acumenexport.body="The roster was saved successful."}).catch(()=>{this.acumenexport.title="Save failed",this.acumenexport.body="Some errors occurred while saving this roste. Please notify the systems department."}).finally(()=>{e&&$(this.$refs.resultAcumenExportDialog.$el).modal("show")})})})},completeRosterSave:function(){if(this.roster.id){let t=this.saveRosterEmployees(),e=this.removeDeletedRosterEmployees(),i=t.concat(e);return Promise.all(i).then(()=>{Promise.all(this.saveRosterSchedules())})}return Promise.resolve(null)},saveRosterEmployees:function(){let t=[];for(let e of this.employees)e.emp_no&&t.push(this.saveRosterEmployee(e));return t},removeDeletedRosterEmployees:function(){let t=[];for(let e of this.deletedEmployeeIDs)t.push(this.deleteRosterEmployee(e));return t},saveRosterEmployee:function(t){let e=new FormData;e.append("rostersID",this.roster.id);let i=0;t.id&&(i=t.id),e.append("id",i),e.append("emp_no",t.emp_no),e.append("defaultposition",t.defaultPosition),e.append("defaultqualifier",t.defaultQualifier),e.append("sectionsdefid",t.sectionsDefID);let s="saverosteremployee.php";return fetch(s,{method:"POST",body:e}).then(t=>t.json()).then(e=>{e&&(t.id&&"0"!==t.id||(t.id=e[0].id))})},deleteRosterEmployee:function(t){let e=`deleterosteremployee.php?id=${t}`;return fetch(e).catch(e=>console.error(`Failed to delete employee with id: ${t} due to the following error:`,e))},saveRosterSchedules:function(){let t=[];for(let e of this.employees)for(let i of e.schedules)i.isDirty&&(i.shiftstring?t.push(this.saveRosterSchedule(e.id,i)):parseInt(i.id)>0&&t.push(this.deleteEmployeeSchedule(i.id)));return t},saveRosterSchedule:function(t,e){let i=`saverosterschedule.php?rosterEmpID=${t}&date=${e.date.format("YYYY-MM-DD")}&shiftstring=${encodeURIComponent(e.getFullShiftString())}`;return e.firstShift&&(i+=`&locid1=${e.firstShift.location}`),e.secondShift&&(i+=`&locid2=${e.secondShift.location}`),fetch(i).then(t=>t.json()).then(t=>{t&&(e.id=t,e.isDirty=!1)})},deleteEmployeeSchedule:function(t){let e=`deleteemployeeschedule.php?id=${t}`;return fetch(e).then(t=>t.json()).catch(e=>console.error(`Failed to delete employee with id: ${t} due to the following error:`,e))},insertPayException:function(t,e){let i=this.getPComment(e.shiftstring),s=new FormData;s.append("emp_no",t.emp_no),s.append("pComment",i),s.append("date",e.date.format("YYYY-MM-DD")),s.append("islive",this.location.isLive);let o="insertPayException.php";return fetch(o,{method:"POST",body:s}).then(t=>t.json()).then(t=>t[0].id).catch(t=>0)},deleteSchedule:function(t,e){let i=`deleteSchedule.php?&emp_no=${t.emp_no}&date=${e.format("YYYY-MM-DD")}&islive=${this.location.isLive}`;return fetch(i).catch(t=>console.error("Failed to delete Working Schedule",t))},deleteSchedules:function(){let t=[];for(let e of this.employees)for(let i of e.schedules)t.push(this.deleteSchedule(e,i.date));return Promise.all(t)},insertWorkingSchedule:function(t,e){let i=new FormData;i.append("emp_no",t.emp_no),i.append("date",e.date.format("YYYY-MM-DD hh:mma")),i.append("start",e.starttime.format("YYYY-MM-DD hh:mma")),i.append("stop",e.endtime.format("YYYY-MM-DD hh:mma")),i.append("locid",e.location),i.append("position",e.position),i.append("qualifier",e.qualifier),i.append("islive",this.location.isLive);let s="insertWorkingSchedule.php";return fetch(s,{method:"POST",body:i}).then(t=>t.json()).then(t=>t[0].id).catch(t=>0)},insertSchedules:function(){let t=[],e=[];for(let i of this.employees)for(let s of i.schedules)s.isExcuse()?t.push(this.insertPayException(i,s)):(s.firstShift&&e.push(this.insertWorkingSchedule(i,s.firstShift)),s.secondShift&&e.push(this.insertWorkingSchedule(i,s.secondShift)));let i=0,s=0;Promise.all(t).then(t=>{t.forEach(function(t){0===parseInt(t)&&i++})}),Promise.all(e).then(t=>{t.forEach(function(t){0===parseInt(t)&&s++})}),i>0||s>0?(this.acumenexport.title="Export failed",this.acumenexport.body="Some errors occurred while exporting this roster to Acumen. Please notify the systems department."):(this.acumenexport.title="Export succeeded",this.acumenexport.body="The export was successful."),$(this.$refs.resultAcumenExportDialog.$el).modal("show")},exportToAcumen:function(){this.saveRoster(!0),this.deleteSchedules().then(this.insertSchedules()).then(this.loadRoster())},finalPrint:function(){this.showdrafttext=!1,window.onafterprint=(()=>{this.showdrafttext=!0}),this.$nextTick(function(){window.print()})},menuoption_exportToAcumen:function(){this.nomissingcells>0?($(this.$refs.missingCellsDialog.$el.querySelector("#missingCellsDialogOKButton")).on("click",this.missingCellsModalOKClicked),$(this.$refs.missingCellsDialog.$el).modal("show")):this.exportToAcumen()},confirmApprovalOKClicked:function(){$(this.$refs.confirmApproval.$el.querySelector("#confirmApproval_OkButton")).off("click"),$(this.$refs.confirmApproval.$el).modal("hide"),this.approveRoster(),this.menuoption_exportToAcumen()},menuoption_approve:function(){$(this.$refs.confirmApproval.$el.querySelector("#confirmApproval_OkButton")).on("click",this.confirmApprovalOKClicked),$(this.$refs.confirmApproval.$el).modal("show")},menuoption_finalPrint:function(){this.finalPrint()},menuoption_copyFrom:function(){$(this.$refs.deleteSchedulesDialog.$el.querySelector("#okbutton")).on("click",this.showCopyFromModal),$(this.$refs.deleteSchedulesDialog.$el).modal("show")},showCopyFromModal:function(){$(this.$refs.deleteSchedulesDialog.$el).modal("hide"),$(this.$refs.deleteSchedulesDialog.$el.querySelector("#okbutton")).off("click"),$(this.$refs.copyfromrosterDialog.$el).modal("show")},copyFromRoster:function(t){$(this.$refs.copyfromrosterDialog.$el).modal("hide"),this.removeSchedules();let e=new moment(t.weekstarting,"YYYY-MM-DD");this.loadRosterSchedulesFromCopy(e)},deleteSchedulesOKClicked:function(){$(this.$refs.deleteSchedulesDialog.$el).modal("hide")},removeSchedules:function(){for(let t of this.employees)for(let e of t.schedules)e.shiftstring&&(e.id=0,e.shiftstring="",e.setShifts(),e.isDirty=!0);this.emitScheduleUpdated()},updateSchedules:function(t){for(let e of t){let t=this.findEmployeeByEmpNo(e.emp_no),i=this.findScheduleIndexByWeekDate(e.date);if(t&&null!==i){let s=t.schedules[i];s.id=0,s.shiftstring=e.shiftstring,s.setShifts(),s.format("short"),s.isDirty=!0}}this.emitScheduleUpdated()},menuoption_changeLocation:function(t){EventBus.$emit("CHANGE-LOCATION",t)},menuoption_changePosition:function(t){EventBus.$emit("CHANGE-POSITION",t)},menuoption_setExcuseCode:function(t){EventBus.$emit("SET-EXCUSECODE",t)},missingCellsModalOKClicked:function(){$(this.$refs.missingCellsDialog.$el.querySelector("#missingCellsDialogOKButton")).off("click"),$(this.$refs.missingCellsDialog.$el).modal("hide"),this.exportToAcumen()},menuoption_print:function(){window.print()},menuoption_printdraft:function(){window.print()},menuoption_deleteAllShifts:function(){$(this.$refs.deleteSchedulesDialog.$el.querySelector("#okbutton")).on("click",this.deleteAllShifts),$(this.$refs.deleteSchedulesDialog.$el).modal("show")},actionMenuOption:function(t){EventBus.$emit("MENUOPTION-SELECTION",t)},menuoption_cut:function(){this.actionMenuOption("cut")},menuoption_copy:function(){this.actionMenuOption("copy")},menuoption_paste:function(){this.actionMenuOption("paste")},menuoption_showStats:function(){$(this.$refs.showstats.$el).modal("show")},menuoption_shortcuts:function(){$(this.$refs.shortcutsDialog.$el).modal("show")},menuoption_copyurl:function(){$("#rosterurl input").focus(),$("#rosterurl input").select(),document.execCommand("copy")},deleteAllShifts:function(){$(this.$refs.deleteSchedulesDialog.$el).modal("hide"),$(this.$refs.deleteSchedulesDialog.$el.querySelector("#okbutton")).off("click"),this.removeSchedules()},getPComment:function(t){if(this.excusecodes)for(let e=0;e<this.excusecodes.length;e++)if(this.excusecodes[e].code===t)return this.excusecodes[e].pComment;return null},extractPositions:function(t){this.positions=[],this.patternpositions=[];for(let e=0;e<t.length;e++){let i=t[e].position;if(this.positions.push(i),i.includes(" ")){let t=i.split(" ");this.patternpositions.push(t[1])}else this.patternpositions.push(i)}patterns.position=patterns.position.replace("~",this.patternpositions.join("|"))},modalOKClicked:function(t){this.validate()&&(this.setWeekstarting(),this.setLocation(),hideModal())},setWeekstarting:function(){this.weekending&&(this.weekstarting=moment(this.formatWeekending(),"MM/DD/YYYY").subtract(6,"days"))},setLocation:function(){this.locID&&this.weekending&&(this.location=this.getLocation(this.locID))},getLocation:function(t){for(let e of this.locations)if(e.locID===t)return e;return null},formatWeekending:function(){let t=this.weekending.getDate(),e=this.weekending.getMonth()+1,i=this.weekending.getFullYear();return t<10&&(t=`0${t}`),e<10&&(e=`0${e}`),`${e}/${t}/${i}`},selectEmployee:function(t){this.editEmployeeIndex=t,(this.deletedemployees.length>0||this.otheremployees.length>0)&&showSelectEmployeeModal()},employeeSelected:function(t){hideSelectEmployeeModal(),this.employees[this.editEmployeeIndex].emp_no=t.emp_no,this.employees[this.editEmployeeIndex].emp_fname=t.emp_fname,this.employees[this.editEmployeeIndex].emp_lname=t.emp_lname,this.employees[this.editEmployeeIndex].defaultLocation=t.defaultLocation,t.visitor?(this.employees[this.editEmployeeIndex].visitor=!0,this.removeEmployee(this.otheremployees,t)):this.removeEmployee(this.deletedemployees,t),this.editEmployeeIndex=-1,this.updatestats()},enterShifts:function(t){this.editdata=t,this.$nextTick(function(){showShiftEntryModal(),EventBus.$emit("SHOW-SHIFTENTRYMODAL",t)})},removeEmployee:function(t,e){let i=-1;for(let s=0;s<t.length;s++)if(t[s].emp_no===e.emp_no){i=s;break}t.splice(i,1)},isValidLocation:function(){let t=!0;return this.locID?this.errors.location=!1:(t=!1,this.errors.location=!0),t},isValidWeekending:function(){let t=!0;return this.weekending?this.errors.weekending=!1:(t=!1,this.errors.weekending=!0),t},validate:function(){let t=this.isValidLocation();return t=this.isValidWeekending()&&t,t},locationChanged:function(){if(this.isValidLocation()){let t=this.getLocation(this.locID),e=parseInt(t.weekends);this.disabledDates.days=[];for(let t=0;t<7;t++)t!==e-1&&this.disabledDates.days.push(t)}},weekendingSelected:function(){this.isValidWeekending()},sortEmployees:function(t,e){var i=`${t.emp_fname} ${t.emp_lname}`.toUpperCase(),s=`${e.emp_fname} ${e.emp_lname}`.toUpperCase();return i<s?-1:i>s?1:0},handleCellHighlighting:function(){if(this.highlight.start&&this.highlight.end){let t=this.orderValues(this.highlight.start.row,this.highlight.end.row),e=this.orderValues(this.highlight.start.column,this.highlight.end.column);for(let i=t.smaller;i<=t.larger;i++)for(let t=e.smaller;t<=e.larger;t++)EventBus.$emit("HIGHLIGHT-CELL",{row:i,column:t})}},orderValues:function(t,e){if(t=parseInt(t),e=parseInt(e),e<t){var i=t;t=e,e=i}return{smaller:t,larger:e}},save:function(){this.saveRoster(!1,!0)},resetPatternsPosition:function(){patterns.position="(?:(?:\\s*)((?:#?)(rest|barn|dtru)?)?\\s?(~))"},menuoption_new:function(){this.schedulesloaded=!1,this.roster=null,this.sections=null,this.employees=null,this.savedschedules=null,this.positionQualifiers=null,this.excusecodes=null,this.location=null,this.locID="",this.weekending=null,this.weekstarting=null,this.positions=[],this.nomissingcells=0,this.noinvalidcells=0,this.totalhours=0,this.loanedhours=0,this.agreedhours=0,this.additionalhours=0,this.deletedemployees=[],this.deletedEmployeeIDs=[],this.otheremployees=[],this.editEmployeeIndex=-1,this.editdata=null,this.locationsqualifiers=[],this.errors.location=!1,this.errors.weekending=!1,this.contextMenuEnabled=!1,this.highlight.start=null,this.highlight.end=null,this.approvedrosters=[],this.hoursexceeded=0,this.hoursexceeded_shiftstring="",this.hoursexceeded_cell=null,this.resetPatternsPosition(),this.validate(),showStartupModal()},emitScheduleUpdated:function(){EventBus.$emit("SCHEDULE-UPDATED")},isValidRosteredAtLocation:function(t){let e=new RegExp(this.location.rosteredat,"gi");return e.test(t.type)},chooseShift:function(t){this.shiftchoices.cell=t.cell,this.shiftchoices.choices=t.choices,$(this.$refs.selectshiftDialog.$el).modal("show")},shiftSelected:function(t){$(this.$refs.selectshiftDialog.$el).modal("hide"),EventBus.$emit("SHIFT-CHOSEN",{cell:this.shiftchoices.cell,shift:t})}},created:function(){let t="getlocations-2.php";fetch(t).then(t=>t.json()).then(t=>{this.locations=t,data.locations=t}),t="getoptions.php",fetch(t).then(t=>t.json()).then(t=>{this.options=t})},mounted:function(){EventBus.$on("CELL-HIGHLIGHT-START",t=>{this.highlight.start=t}),EventBus.$on("CELL-HIGHLIGHT-END",t=>{this.highlight.end=t,this.handleCellHighlighting()}),EventBus.$on("CELL-UNHIGHLIGHTED",()=>{this.highlight.start=null,this.highlight.end=null}),EventBus.$on("ARROW-RIGHT",t=>{let e={row:t.row,column:t.column};t.column<7?e.column=t.column+1:7===t.column&&(e.row=t.row+1,e.column=1),EventBus.$emit("TAKE-FOCUS",e)}),EventBus.$on("ARROW-LEFT",t=>{let e={row:t.row,column:t.column};t.column>1?e.column=t.column-1:1===t.column&&(e.row=t.row-1,e.column=7),EventBus.$emit("TAKE-FOCUS",e)}),EventBus.$on("ARROW-DOWN",t=>{let e={row:t.row,column:t.column};e.row=t.row+1,EventBus.$emit("TAKE-FOCUS",e)}),EventBus.$on("ARROW-UP",t=>{let e={row:t.row,column:t.column};e.row=t.row-1,EventBus.$emit("TAKE-FOCUS",e)}),EventBus.$on("HOURS-EXCEEDED",t=>{this.hoursexceeded=data.location.maximumshift,this.hoursexceeded_shiftstring=t.schedule.shiftstring,this.hoursexceeded_cell=t.cell,$(this.$refs.maximumHoursExceededDialog.$el).modal("show")}),EventBus.$on("CUTORCOPY",t=>{this.texttopaste=!0,data.clipboard=t}),EventBus.$on("CHOOSE-SHIFT",t=>{this.chooseShift(t)})}});